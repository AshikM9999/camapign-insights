<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 1.5rem;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 0.5rem;
        }
        .header p {
            font-size: 1.1rem;
            color: #4a5568;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background-color: #edf2f7;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        .stat-card h3 {
            font-size: 1rem;
            color: #4a5568;
            margin-bottom: 0.5rem;
        }
        .stat-card p {
            font-size: 2rem;
            font-weight: 600;
            color: #2d3748;
        }
        .chart-section {
            background-color: #fff;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
        }
        .chart-section h2 {
            font-size: 1.8rem;
            font-weight: 600;
            color: #1a202c;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .campaigns-table {
            background-color: #fff;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        .campaigns-table h2 {
            font-size: 1.8rem;
            font-weight: 600;
            color: #1a202c;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        th {
            background-color: #f7fafc;
            font-weight: 600;
            color: #2d3748;
            text-transform: uppercase;
            font-size: 0.9rem;
        }
        tr:hover {
            background-color: #edf2f7;
        }
        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }
        .status-active {
            background-color: #c6f6d5;
            color: #2f855a;
        }
        .status-paused {
            background-color: #feebc8;
            color: #b7791f;
        }
        .status-completed {
            background-color: #e2e8f0;
            color: #4a5568;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
        }
        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            margin-top: 1rem;
            font-size: 1.2rem;
            color: #3498db;
        }
    </style>
</head>
<body>
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p class="loading-text">Loading campaign data...</p>
    </div>

    <div class="container hidden" id="dashboard-content">
        <div class="header">
            <h1>Marketing Campaign Dashboard</h1>
            <p>Overview of your active, paused, and completed campaigns.</p>
        </div>

        <div class="stats-grid" id="stats-grid">
            <!-- Stats will be dynamically loaded here -->
        </div>

        <div class="chart-section">
            <h2>Campaign Performance Over Time</h2>
            <canvas id="campaignChart"></canvas>
        </div>

        <div class="campaigns-table">
            <h2>All Campaigns</h2>
            <table id="campaigns-table">
                <thead>
                    <tr>
                        <th>Campaign Name</th>
                        <th>Status</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Budget</th>
                        <th>Spend</th>
                        <th>ROI</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Campaign data will be dynamically loaded here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Sample hardcoded campaign data
        const sampleCampaignData = [
            {
                "Campaign Name": "Summer Sale 2024",
                "Status": "Active",
                "Start Date": "2024-06-01",
                "End Date": "2024-08-31",
                "Budget": 50000,
                "Spend": 35000,
                "ROI": 1.5
            },
            {
                "Campaign Name": "New Product Launch",
                "Status": "Paused",
                "Start Date": "2024-05-15",
                "End Date": "2024-07-15",
                "Budget": 25000,
                "Spend": 20000,
                "ROI": 1.2
            },
            {
                "Campaign Name": "Holiday Season 2023",
                "Status": "Completed",
                "Start Date": "2023-11-01",
                "End Date": "2023-12-31",
                "Budget": 75000,
                "Spend": 70000,
                "ROI": 2.1
            },
            {
                "Campaign Name": "Spring Collection Promo",
                "Status": "Active",
                "Start Date": "2024-03-01",
                "End Date": "2024-05-31",
                "Budget": 30000,
                "Spend": 28000,
                "ROI": 1.8
            },
            {
                "Campaign Name": "Black Friday Deals",
                "Status": "Completed",
                "Start Date": "2023-11-20",
                "End Date": "2023-11-27",
                "Budget": 60000,
                "Spend": 58000,
                "ROI": 2.5
            },
            {
                "Campaign Name": "Winter Clearance",
                "Status": "Active",
                "Start Date": "2024-01-01",
                "End Date": "2024-02-28",
                "Budget": 20000,
                "Spend": 15000,
                "ROI": 1.3
            },
            {
                "Campaign Name": "Back to School",
                "Status": "Paused",
                "Start Date": "2024-07-20",
                "End Date": "2024-09-10",
                "Budget": 40000,
                "Spend": 10000,
                "ROI": 0.8
            }
        ];

        /**
         * Fetches campaign data from a simulated source (hardcoded data).
         * @returns {Promise<Array<Object>>} A promise that resolves with the campaign data.
         */
        async function fetchDataFromGoogleSheet() {
            return new Promise(resolve => {
                // Simulate network delay
                setTimeout(() => {
                    resolve(sampleCampaignData);
                }, 1000); // 1 second delay
            });
        }

        /**
         * Displays key statistics on the dashboard.
         * @param {Array<Object>} campaigns - The array of campaign data.
         */
        function displayStats(campaigns) {
            const totalCampaigns = campaigns.length;
            const activeCampaigns = campaigns.filter(c => c.Status === 'Active').length;
            const pausedCampaigns = campaigns.filter(c => c.Status === 'Paused').length;
            const completedCampaigns = campaigns.filter(c => c.Status === 'Completed').length;

            const totalBudget = campaigns.reduce((sum, c) => sum + (c.Budget || 0), 0);
            const totalSpend = campaigns.reduce((sum, c) => sum + (c.Spend || 0), 0);
            const averageROI = campaigns.reduce((sum, c) => sum + (c.ROI || 0), 0) / totalCampaigns;

            const statsGrid = document.getElementById('stats-grid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <h3>Total Campaigns</h3>
                    <p>${totalCampaigns}</p>
                </div>
                <div class="stat-card">
                    <h3>Active Campaigns</h3>
                    <p>${activeCampaigns}</p>
                </div>
                <div class="stat-card">
                    <h3>Paused Campaigns</h3>
                    <p>${pausedCampaigns}</p>
                </div>
                <div class="stat-card">
                    <h3>Completed Campaigns</h3>
                    <p>${completedCampaigns}</p>
                </div>
                <div class="stat-card">
                    <h3>Total Budget</h3>
                    <p>$${totalBudget.toLocaleString()}</p>
                </div>
                <div class="stat-card">
                    <h3>Total Spend</h3>
                    <p>$${totalSpend.toLocaleString()}</p>
                </div>
                <div class="stat-card">
                    <h3>Average ROI</h3>
                    <p>${averageROI.toFixed(2)}</p>
                </div>
            `;
        }

        /**
         * Displays campaign data in a table.
         * @param {Array<Object>} campaigns - The array of campaign data.
         */
        function displayCampaigns(campaigns) {
            const tableBody = document.getElementById('campaigns-table').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = ''; // Clear existing rows

            campaigns.forEach(campaign => {
                const row = tableBody.insertRow();
                const statusClass = {
                    'Active': 'status-active',
                    'Paused': 'status-paused',
                    'Completed': 'status-completed'
                }[campaign.Status] || '';

                row.innerHTML = `
                    <td>${campaign['Campaign Name']}</td>
                    <td><span class="status-badge ${statusClass}">${campaign.Status}</span></td>
                    <td>${campaign['Start Date']}</td>
                    <td>${campaign['End Date']}</td>
                    <td>$${(campaign.Budget || 0).toLocaleString()}</td>
                    <td>$${(campaign.Spend || 0).toLocaleString()}</td>
                    <td>${(campaign.ROI || 0).toFixed(2)}</td>
                `;
            });
        }

        /**
         * Displays a chart showing campaign performance (e.g., spend over time).
         * @param {Array<Object>} campaigns - The array of campaign data.
         */
        function displayChart(campaigns) {
            const ctx = document.getElementById('campaignChart').getContext('2d');

            // Aggregate data for the chart (e.g., total spend per month)
            const monthlySpend = {};
            campaigns.forEach(campaign => {
                const startDate = new Date(campaign['Start Date']);
                const endDate = new Date(campaign['End Date']);
                const spend = campaign.Spend || 0;

                // Simple distribution of spend over months for demonstration
                let currentMonth = new Date(startDate);
                while (currentMonth <= endDate) {
                    const monthKey = `${currentMonth.getFullYear()}-${(currentMonth.getMonth() + 1).toString().padStart(2, '0')}`;
                    monthlySpend[monthKey] = (monthlySpend[monthKey] || 0) + (spend / ((endDate.getMonth() - startDate.getMonth() + 1) || 1));
                    currentMonth.setMonth(currentMonth.getMonth() + 1);
                }
            });

            const sortedMonths = Object.keys(monthlySpend).sort();
            const labels = sortedMonths.map(month => {
                const [year, monthNum] = month.split('-');
                const date = new Date(year, parseInt(monthNum) - 1);
                return date.toLocaleString('default', { month: 'short', year: 'numeric' });
            });
            const data = sortedMonths.map(month => monthlySpend[month]);

            if (window.campaignChartInstance) {
                window.campaignChartInstance.destroy(); // Destroy previous chart instance
            }

            window.campaignChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total Spend ($)',
                        data: data,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Month'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Spend ($)'
                            }
                        }
                    }
                }
            });
        }

        // Initialize dashboard on window load
        window.onload = async function() {
            const loadingOverlay = document.getElementById('loading-overlay');
            const dashboardContent = document.getElementById('dashboard-content');

            try {
                const campaignData = await fetchDataFromGoogleSheet();
                displayStats(campaignData);
                displayCampaigns(campaignData);
                displayChart(campaignData);
                loadingOverlay.classList.add('hidden');
                dashboardContent.classList.remove('hidden');
            } catch (error) {
                console.error('Error fetching campaign data:', error);
                loadingOverlay.innerHTML = `<p class="loading-text text-red-500">Failed to load data. Please try again later.</p>`;
            }
        };
    </script>
</body>
</html>
